{"version":3,"file":"BQFGOfkz.min.js","names":["engineDescriptions: Record<string, [string, string]> | undefined","engineElements: NodeListOf<HTMLElement>","engineToggles: NodeListOf<HTMLInputElement>","enableAllEngines: NodeListOf<HTMLElement>","disableAllEngines: NodeListOf<HTMLElement>"],"sources":["../../../../../client/simple/src/js/main/preferences.ts"],"sourcesContent":["// SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport { http, listen, settings } from \"../toolkit.ts\";\nimport { assertElement } from \"../util/assertElement.ts\";\n\nlet engineDescriptions: Record<string, [string, string]> | undefined;\n\nconst loadEngineDescriptions = async (): Promise<void> => {\n  if (engineDescriptions) return;\n  try {\n    const res = await http(\"GET\", \"engine_descriptions.json\");\n    engineDescriptions = await res.json();\n  } catch (error) {\n    console.error(\"Error fetching engineDescriptions:\", error);\n  }\n  if (!engineDescriptions) return;\n\n  for (const [engine_name, [description, source]] of Object.entries(engineDescriptions)) {\n    const elements = document.querySelectorAll<HTMLElement>(`[data-engine-name=\"${engine_name}\"] .engine-description`);\n    const sourceText = ` (<i>${settings.translations?.Source}:&nbsp;${source}</i>)`;\n\n    for (const element of elements) {\n      element.innerHTML = description + sourceText;\n    }\n  }\n};\n\nconst toggleEngines = (enable: boolean, engineToggles: NodeListOf<HTMLInputElement>): void => {\n  for (const engineToggle of engineToggles) {\n    // check if element visible, so that only engines of the current category are modified\n    if (engineToggle.offsetParent) {\n      engineToggle.checked = !enable;\n    }\n  }\n};\n\nconst engineElements: NodeListOf<HTMLElement> = document.querySelectorAll<HTMLElement>(\"[data-engine-name]\");\nfor (const engineElement of engineElements) {\n  listen(\"mouseenter\", engineElement, loadEngineDescriptions);\n}\n\nconst engineToggles: NodeListOf<HTMLInputElement> = document.querySelectorAll<HTMLInputElement>(\n  \"tbody input[type=checkbox][class~=checkbox-onoff]\"\n);\n\nconst enableAllEngines: NodeListOf<HTMLElement> = document.querySelectorAll<HTMLElement>(\".enable-all-engines\");\nfor (const engine of enableAllEngines) {\n  listen(\"click\", engine, () => toggleEngines(true, engineToggles));\n}\n\nconst disableAllEngines: NodeListOf<HTMLElement> = document.querySelectorAll<HTMLElement>(\".disable-all-engines\");\nfor (const engine of disableAllEngines) {\n  listen(\"click\", engine, () => toggleEngines(false, engineToggles));\n}\n\nlisten(\"click\", \"#copy-hash\", async function (this: HTMLElement) {\n  const target = this.parentElement?.querySelector<HTMLPreElement>(\"pre\");\n  assertElement(target);\n\n  if (window.isSecureContext) {\n    await navigator.clipboard.writeText(target.innerText);\n  } else {\n    const selection = window.getSelection();\n    if (selection) {\n      const range = document.createRange();\n      range.selectNodeContents(target);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      document.execCommand(\"copy\");\n    }\n  }\n\n  const copiedText = this.dataset.copiedText;\n  if (copiedText) {\n    this.innerText = copiedText;\n  }\n});\n\nconst volumeSlider = document.getElementById(\"alarm_volume\") as HTMLInputElement | null;\nconst volumeDisplay = document.getElementById(\"alarm_volume_display\");\nif (volumeSlider && volumeDisplay) {\n  volumeSlider.addEventListener(\"input\", () => {\n    volumeDisplay.textContent = `${volumeSlider.value}%`;\n  });\n}\n\nconst testSoundBtn = document.getElementById(\"test_alarm_sound\") as HTMLButtonElement | null;\nconst alarmSoundSelect = document.getElementById(\"alarm_sound\") as HTMLSelectElement | null;\nif (testSoundBtn && alarmSoundSelect && volumeSlider) {\n  let isPlaying = false;\n  const originalText = testSoundBtn.textContent || \"Test\";\n\n  testSoundBtn.addEventListener(\"click\", () => {\n    const testFn = (window as Window & { testAlarmSound?: (sound: string, volume: number) => void }).testAlarmSound;\n    const stopFn = (window as Window & { stopAlarmSound?: () => void }).stopAlarmSound;\n\n    if (isPlaying) {\n      if (stopFn) stopFn();\n      testSoundBtn.textContent = originalText;\n      isPlaying = false;\n    } else {\n      if (testFn) {\n        testFn(alarmSoundSelect.value, Number.parseInt(volumeSlider.value, 10));\n        testSoundBtn.textContent = \"Stop\";\n        isPlaying = true;\n      }\n    }\n  });\n}\n\nconst CLOCK_SETTINGS_SAVED_KEY = \"clockSettingsSaved\";\nconst NOTIFICATION_DISPLAY_DURATION = 3000;\nconst NOTIFICATION_FADE_DURATION = 300;\n\nconst hasClockSettings = (): boolean => {\n  return (\n    document.getElementById(\"clock_enabled\") !== null ||\n    document.getElementById(\"clock_format\") !== null ||\n    document.getElementById(\"alarm_time\") !== null ||\n    document.getElementById(\"alarm_sound\") !== null ||\n    document.getElementById(\"alarm_volume\") !== null\n  );\n};\n\nconst showClockSavedNotification = (): void => {\n  const notification = document.createElement(\"div\");\n  notification.className = \"clock-saved-notification\";\n  notification.textContent = \"Clock settings saved!\";\n  notification.setAttribute(\"role\", \"alert\");\n  document.body.appendChild(notification);\n\n  requestAnimationFrame(() => {\n    notification.classList.add(\"show\");\n  });\n\n  setTimeout(() => {\n    notification.classList.remove(\"show\");\n    setTimeout(() => notification.remove(), NOTIFICATION_FADE_DURATION);\n  }, NOTIFICATION_DISPLAY_DURATION);\n};\n\nconst preferencesForm = document.getElementById(\"search_form\") as HTMLFormElement | null;\nif (preferencesForm) {\n  preferencesForm.addEventListener(\"submit\", () => {\n    if (hasClockSettings()) {\n      sessionStorage.setItem(CLOCK_SETTINGS_SAVED_KEY, \"true\");\n    }\n  });\n\n  if (sessionStorage.getItem(CLOCK_SETTINGS_SAVED_KEY) === \"true\") {\n    sessionStorage.removeItem(CLOCK_SETTINGS_SAVED_KEY);\n    showClockSavedNotification();\n  }\n}\n\nconst notificationBtn = document.getElementById(\"enable_notifications\");\nconst notificationStatus = document.getElementById(\"notification_status\");\nif (notificationBtn && notificationStatus) {\n  const updateNotificationStatus = (): void => {\n    if (!(\"Notification\" in window)) {\n      notificationStatus.textContent = \"Not supported\";\n      notificationStatus.className = \"notification-status denied\";\n      notificationBtn.style.display = \"none\";\n      return;\n    }\n    if (Notification.permission === \"granted\") {\n      notificationStatus.textContent = \"Enabled\";\n      notificationStatus.className = \"notification-status granted\";\n      notificationBtn.style.display = \"none\";\n    } else if (Notification.permission === \"denied\") {\n      notificationStatus.textContent = \"Blocked\";\n      notificationStatus.className = \"notification-status denied\";\n      notificationBtn.style.display = \"none\";\n    } else {\n      notificationStatus.textContent = \"\";\n      notificationBtn.style.display = \"inline-block\";\n    }\n  };\n\n  updateNotificationStatus();\n\n  notificationBtn.addEventListener(\"click\", async () => {\n    const reqFn = (window as Window & { requestNotificationPermission?: () => Promise<boolean> }).requestNotificationPermission;\n    if (reqFn) {\n      await reqFn();\n    } else if (\"Notification\" in window) {\n      await Notification.requestPermission();\n    }\n    updateNotificationStatus();\n  });\n}\n"],"mappings":"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"}